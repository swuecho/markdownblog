<!DOCTYPE html>
<html>
<meta charset="utf-8">
      <title>文件读写</title>
<xmp theme="readable" style="display:none;">

许多Perl程序涉及文本处理，我们接下来学习怎么写入文件。


文件的读写，其实是操作系统的事情。Perl 只是告诉操作系统你想做的，在写入之前，要先打开，
Perl 中 用<hl>open</hl> 函数。打开之后，进行相应的操作，然后关闭。
此流程与用记事本打开一个文本文档，输入文本，然后保存关闭是一样的。

    use v5.14;
    my $filename = 'report.txt';
    open(my $fh, '>', $filename) or die "Could not open file '$filename' $!";
    print $fh "My first report generated by perl\n";
    close $fh;
    print "done\n";
    </code>

以上是个很好的例子，但是稍微有些复杂。我们从更简单的例子开始。

<h2>简化版</h2>

    use v5.14;
    open(my $fh, '>', 'report.txt');
    print $fh "My first report generated by perl\n";
    close $fh;
    print "done\n";

<b>open</b> 函数有三个参数.


第一个参数<hl>$fh</hl> 是一个标量。这里你只要记住，它是一个特殊的标量，与你打开的文件相关连。
我们可以在<hl>open</hl> 函数之前声明<hl>$fh</hl>，但是，为了方便，通常这样写。

第二个参数定义我们打开文件将要干什么。在这里，我们写入。所以用(<hl>&gt;</hl>)。为什么要用  (<hl>&gt;</hl>)呢？
历史原因，如果你熟悉命令行，或许你已经猜到为什么了。

第三个参数是要打开文件的路径。

注意<hl>print()</hl> 在例子中两处的区别，第一处后面多了一个变量 <hl>$fh</hl>，注意其后并没有逗号。
第一个<hl>print()</hl> 把字符串输出到文件中，第二个<hl>print()</hl> 把文件输出到终端。

别忘了例子中的 close 函数。你可以理解为，它帮你关闭你刚才打的文件。
严格的讲，并非必须，Perl确定不会再有输入的时候，通常会帮你自动关闭。
但是，强烈建议你自己关闭。



<h2>异常处理</h2>

你观察一下上面的两个例子，看到他们的区别了么？简化版中没有 or die "Could not open file '$filename' $!";

为什么呢？想一想，如果你给的文件路径不存在怎么办？这叫异常处理。篇幅限制，这里不详细介绍。

<h2>补充</h2>

以上都是Perl自带的函数，Perl的理念之一就是总有更好的方法，另外，还有CPAN。

如果你想用更简单的方法写入文本到文件中，你可一用Path::Tiny 模块。

回到我们的第一个例子。

    use strict;
    use warnings;

    my $filename = 'report.txt';
    open(my $fh, '>', $filename) or die "Could not open file '$filename' $!";
    print $fh "My first report generated by perl\n";
    close $fh;
    print "done\n";

该例子等价于：

    use strict;
    use warnings;

    use Path::Tiny; 

    my $filename = 'report.txt';
    my $path = path($filename);
    $path->spew("My first report generated by perl\n");

    print "done";

spew 的意思是快速输出。

读取也很简单。

    use strict;
    use warnings;

    use Path::Tiny; 

    my $filename = 'report.txt';
    my $path = path($filename);
    my $content = $path->slurp;
    print $content;
    print "done";

slurp 的本意是吃东西时发出的声音。这里引申为读。

Path::Tiny 基本包含了你可能经常用到的文件操作函数。更多请参考 Path::Tiny 文档。






</xmp>
<script src="http://strapdownjs.com/v/0.2/strapdown.js"></script>
</html>
